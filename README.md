# AI 聊天侧边栏

一个强大的 Obsidian AI 聊天界面插件，无缝集成到你的笔记库中，让你可以与多个 AI 模型交互，同时利用笔记内容作为上下文。

**当前版本：** 1.0.0

## ✨ 核心功能

### 🤖 AI 集成
- **多提供商支持**：支持 OpenAI、Anthropic 或任何兼容 OpenAI 的自定义 API
- **动态模型切换**：对话中随时切换 AI 模型，不丢失上下文
- **流式响应**：实时观看 AI 回复逐字显示
- **会话管理**：持久化聊天历史，轻松切换会话

### 📝 上下文管理
- **文件和文件夹上下文**：将整个文件或文件夹添加为对话上下文
- **实时选择跟踪**：自动包含你当前选中的文本，带有可视化反馈
- **智能上下文显示**：清晰的视觉指示器区分永久和临时上下文
- **便捷上下文控制**：一键添加或移除上下文项

### 🎨 富文本渲染
- **完整 Markdown 支持**：标题、列表、链接、引用等
- **LaTeX 公式渲染**：使用 MathJax 渲染精美的数学符号
- **语法高亮**：支持 100+ 种编程语言的代码高亮
- **紧凑布局**：优化的间距，阅读更舒适

### 📋 复制功能
- **一键复制**：复制完整消息、代码块或 LaTeX 公式
- **智能复制**：代码块复制时去除 Markdown 语法，LaTeX 复制源代码
- **视觉反馈**：复制成功后即时显示确认

### 🔒 隐私与安全
- **直接 API 调用**：无第三方中介
- **本地存储**：所有数据保存在你的笔记库中
- **无遥测**：零追踪和分析
- **加密密钥**：API 密钥安全存储

## 📦 安装

### 从 Obsidian 社区插件安装（推荐）

1. 打开 **设置 → 第三方插件**
2. 点击 **浏览** 并搜索 "AI Chat Sidebar"
3. 点击 **安装**，然后 **启用**

### 手动安装

1. 从 [最新版本](https://github.com/haibarazz/obsidian-ai-chats) 下载 `main.js`、`manifest.json` 和 `styles.css`
2. 创建文件夹：`<笔记库>/.obsidian/plugins/ai-chat-sidebar/`
3. 将下载的文件复制到该文件夹
4. 重新加载 Obsidian 并在 **设置 → 第三方插件** 中启用插件

## ⚙️ 快速开始

### 1. 配置 AI 提供商

打开 **设置 → AI Chat Sidebar → 提供商管理 → 添加提供商**

**OpenAI 示例：**
```
提供商名称：OpenAI
提供商类型：OpenAI
基础 URL：https://api.openai.com/v1
API 密钥：sk-...
```

**Anthropic 示例：**
```
提供商名称：Anthropic
提供商类型：Anthropic
基础 URL：https://api.anthropic.com
API 密钥：sk-ant-...
```

**自定义/本地示例（Ollama）：**
```
提供商名称：本地 LLM
提供商类型：Custom
基础 URL：http://localhost:11434/v1
API 密钥：（留空）
```

### 2. 添加 AI 模型

打开 **设置 → AI Chat Sidebar → 模型管理 → 添加模型**

**常用模型：**
- OpenAI：`gpt-4`、`gpt-4-turbo`、`gpt-3.5-turbo`
- Anthropic：`claude-3-opus-20240229`、`claude-3-sonnet-20240229`、`claude-3-haiku-20240307`
- 本地：`llama2`、`mistral`、`codellama`（取决于你的设置）

### 3. 开始聊天

- 打开聊天：**Ctrl/Cmd + P** → "Open AI Chat"
- 或点击功能区的聊天图标

## 🚀 使用指南

### 基本操作

**打开聊天：**
- 命令：`Ctrl/Cmd + P` → "Open AI Chat"
- 或点击功能区的聊天图标

**发送消息：**
- 输入后按 `Enter` 发送
- `Shift + Enter` 换行

**切换模型：**
- 使用聊天侧边栏顶部的下拉菜单
- 切换时保留历史记录

**新建会话：**
- 命令：`Ctrl/Cmd + P` → "New chat session"
- 之前的对话会自动保存

### 上下文管理

**添加文件：**
1. 点击 **添加上下文** 按钮
2. 选择 **文件** 并选择你的文件
3. 文件内容将包含在所有消息中

**添加文件夹：**
1. 点击 **添加上下文** 按钮
2. 选择 **文件夹**
3. 文件夹中的所有 Markdown 文件都会被包含

**实时选择（自动）：**
- 只需在任何笔记中 **选择文本**
- 出现眼睛图标（👁️）显示你的选择
- 发送消息时选择的内容会 **自动包含**
- **临时性** - 不会占用上下文区域
- 清除选择即可移除

**使用选择聊天：**
- 选择文本 → `Ctrl/Cmd + P` → "Chat with selection"
- 打开聊天并将选择作为上下文

**移除上下文：**
- 点击任何上下文标签上的 **×**
- 实时选择在清除时自动移除

### 富文本功能

**Markdown 渲染：**
- 标题、**粗体**、*斜体*、`行内代码`
- 有序和无序列表
- 可点击的链接和引用块
- 紧凑、易读的布局

**代码语法高亮：**
````
```python
def hello():
    print("你好！")
```
````
- 支持 100+ 种语言
- 悬停显示复制按钮
- 复制时去除 Markdown 语法

**LaTeX 公式：**
- 行内：`$E = mc^2$`
- 块级：`$$\int_0^1 x^2 dx$$`
- 复制按钮复制 LaTeX 源代码
- 完美粘贴到笔记中

**复制功能：**
- **消息**：每条回复右上角的复制按钮
- **代码**：悬停在代码块上复制
- **LaTeX**：点击复制公式源代码
- 视觉对勾（✓）确认复制

## 💡 使用技巧

### 有效使用实时选择
- **快速引用**：选择文本的同时提问
- **迭代编辑**：保持文本选中状态，不断优化问题
- **保持整洁**：实时选择不会占用永久上下文
- **组合使用**：与永久文件上下文一起使用

### 处理代码
- 请求特定语言以获得语法高亮
- 使用复制按钮快速获取和测试代码片段
- 同一对话中支持多种语言

### 数学内容
- 要求 AI 使用 LaTeX 符号表示公式
- 复制 LaTeX 源代码粘贴到笔记中
- 使用 `$...$` 表示行内公式，`$$...$$` 表示块级公式

### 组织对话
- 复制重要回复保存到笔记中
- 根据需要提取单个代码块
- 通过复制 LaTeX 建立公式库

## 🛠️ 开发

### 从源代码构建

```bash
# 克隆仓库
git clone https://github.com/your-repo/ai-chat-sidebar.git
cd ai-chat-sidebar

# 安装依赖
npm install

# 生产构建
npm run build

# 或在开发模式下运行（自动重建）
npm run dev
```

### 运行测试

```bash
# 运行所有测试
npm test

# 监视模式运行测试
npm run test:watch

# 运行测试并生成覆盖率报告
npm run test:coverage
```

### 项目结构

```
src/
  commands/       # 命令实现
  context/        # 上下文管理（包括实时选择）
  services/       # AI 服务客户端
  settings/       # 设置管理
  state/          # 聊天状态管理
  ui/             # UI 组件（聊天视图、Markdown 渲染器、复制管理器）
  utils/          # 工具函数
  types.ts        # TypeScript 接口
main.ts           # 插件入口
styles.css        # 样式
```


## 📊 更新日志

### v1.0.0（当前版本）
- 首次发布
- 多提供商 AI 支持（OpenAI、Anthropic、自定义）
- 带有视觉指示器的实时选择跟踪
- 支持 LaTeX 的富 Markdown 渲染
- 代码语法高亮
- 一键复制消息、代码和公式
- 持久化聊天历史和会话管理
- 流式响应支持
- 注重隐私的架构
